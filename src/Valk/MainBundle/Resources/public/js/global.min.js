/* Â©2013 Blizzard Entertainment, Inc. All rights reserved. */
'use strict';
$(function () {
    $("body").removeClass("preload");
    $("#service").tooltip({selector: "[title]", placement: "bottom"});
    $(".pegi-rating").tooltip({selector: "[title]", placement: "bottom"});
    $(".grb-rating").tooltip({selector: "[title]", placement: "bottom"});
    $(".usk-rating").tooltip({selector: "[title]", placement: "right"});
    $(".acb-rating").tooltip({selector: "[title]", placement: "right"});
    $(".esrb-descriptor").tooltip({selector: "[title]", placement: "right"});
    $(document).ajaxStart(function () {
        $("#ajax-indicator").addClass("fade-in spinner-40-battlenet");
    }).ajaxStop(function () {
        $("#ajax-indicator").removeClass("fade-in spinner-40-battlenet");
    });
    if (typeof window.ScriptPackages === "object" && typeof window.ScriptPackages.LightBox === "object") {
        var a = $("body");
        window.appLightBox = App.LightBox.create({confirmExternalClose: true, confirmExternalCloseMsg: Msg.app.lightbox.confirmExternalClose});
        $('[rel*="external"]').click(function (f) {
            var c = f.target.href, d = c.indexOf("?") > 0 ? "&" : "?";
            f.target.href = c + d + "utm_source=App&utm_medium=marketplace";
        });
        var b = $("[data-lightbox-cancel]").click(function (c) {
            if ($(this).is('[rel*="external"]') === false) {
                c.preventDefault();
                c.stopPropagation();
            }
            if ($(this).attr("data-lightbox-cancel") === "confirm") {
                window.setTimeout(function () {
                    window.appLightBox.close(Msg.app.lightbox.confirmExternalClose);
                }, 300);
            } else {
                window.setTimeout(function () {
                    window.appLightBox.close();
                }, 300);
            }
        }).filter('[data-lightbox-cancel="confirm"]').length;
        window.appLightBox.setConfirmExternalClose(!!b);
        if ($("#success-page").length) {
            window.appLightBox.setConfirmExternalClose(false);
        }
        if (a.hasClass("upgrade-template")) {
            window.appLightBox.setConfirmExternalClose(false);
        }
    }
});
if (typeof App === "undefined") {
    var App = {};
}
(function (b, c) {
    var d = function () {
        this.scriptPackage = null;
        this.config = {};
        this.confirmExternalClose = false;
        this.confirmExternalCloseMsg = "";
    };
    var a = d.prototype;
    a.create = function (f) {
        var e = new d();
        e.init(f);
        return e;
    };
    a.init = function (e) {
        e = e || {};
        this.config = c.extend({confirmExternalClose: false, confirmExternalCloseMsg: ""}, e);
        if (typeof b.ScriptPackages.LightBox === "object") {
            this.scriptPackage = b.ScriptPackages.LightBox;
        }
        this.setup();
    };
    a.setup = function () {
        this.confirmExternalClose = this.config.confirmExternalClose;
        this.confirmExternalCloseMsg = this.config.confirmExternalCloseMsg;
        this.scriptPackage.onExternalCloseRequested = c.proxy(this.externalCloseRequested, this);
    };
    a.setConfirmExternalClose = function (e) {
        if (typeof e === "undefined") {
            e = true;
        } else {
            e = !!e;
        }
        this.confirmExternalClose = e;
    };
    a.setConfirmExternalCloseMsg = function (e) {
        this.confirmExternalCloseMsg = e;
    };
    a.externalCloseRequested = function () {
        if (this.confirmExternalClose) {
            this.close(this.confirmExternalCloseMsg);
            return true;
        } else {
            return false;
        }
    };
    a.close = function (e) {
        e = e || null;
        if (this.scriptPackage) {
            this.scriptPackage.requestClose(e);
        }
    };
    b.App = b.App || {};
    b.App.LightBox = b.App.LightBox || new d();
})(this, jQuery);